{% extends "templates/web.html" %}

{% block title %}Waiter Order{% endblock %}

{% block head_include %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
{% endblock %}

{% block page_content %}
<div class="flex flex-col min-h-screen bg-gray-50">
  <!-- Header Section -->
  <header class="bg-white shadow">
    <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
      <h1 class="text-xl font-bold text-gray-900">Waiter Order Interface</h1>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-grow">
    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
      <!-- Tabs Navigation -->
      <div class="border-b border-gray-200 mb-6" role="tablist">
        <nav class="flex space-x-8" aria-label="Order sections">
          <button class="border-indigo-500 text-indigo-600 whitespace-nowrap pb-4 px-1 border-b-2 font-medium text-sm" role="tab" aria-selected="true" id="tab-tables">
            Active Tables
          </button>
          <button class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap pb-4 px-1 border-b-2 font-medium text-sm" role="tab" aria-selected="false" id="tab-menu">
            Menu Items
          </button>
          <button class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap pb-4 px-1 border-b-2 font-medium text-sm" role="tab" aria-selected="false" id="tab-new-order">
            New Order
          </button>
        </nav>
      </div>

      <!-- Tables Section -->
      <div id="section-tables" class="mb-8" role="tabpanel" aria-labelledby="tab-tables">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-medium text-gray-900">Active Tables</h2>
          <div class="flex items-center space-x-2">
            <span id="selected-table-display" class="text-sm font-medium text-gray-500">No table selected</span>
          </div>
        </div>
        <div id="tables-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
          <!-- Tables will be populated dynamically -->
        </div>
      </div>

      <!-- Menu Items Section -->
      <div id="section-menu" class="hidden mb-8" role="tabpanel" aria-labelledby="tab-menu">
        <div class="mb-4">
          <input id="item-search" type="text" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md p-2" placeholder="Search menu items...">
        </div>
        
        <!-- Item Groups Tabs -->
        <div class="nav-tabs mb-4 flex flex-wrap" role="tablist" aria-label="Item categories">
          <!-- Item group tabs will be populated dynamically -->
        </div>
        
        <!-- Items Grid -->
        <div id="items-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
          <!-- Items will be populated dynamically -->
        </div>
      </div>

      <!-- New Order Section -->
      <div id="section-new-order" class="hidden mb-8" role="tabpanel" aria-labelledby="tab-new-order">
        <div class="bg-white shadow sm:rounded-lg p-4">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Create New Order</h3>
          <div class="flex space-x-2 mb-4">
            <input id="new-order-table-number" type="text" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Table Number">
            <button id="new-order-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Create
            </button>
          </div>
        </div>
      </div>

      <!-- Current Order Summary -->
      <div class="bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
          <h2 class="text-lg font-medium text-gray-900">Current Order</h2>
        </div>
        <div class="border-t border-gray-200">
          <ul id="queue-list" class="divide-y divide-gray-200" aria-label="Order items list" role="list">
            <!-- Order items will be populated dynamically -->
            <li class="p-4 text-center text-gray-500">No items in order</li>
          </ul>
          
          <div id="order-items-container" class="divide-y divide-gray-200">
            <!-- Order items will be populated here dynamically -->
          </div>
          
          <div class="px-4 py-4 sm:px-6 flex justify-end space-x-3">
            <button id="send-additional-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled-btn" disabled>
              Send Additional Items
            </button>
            <button id="send-to-kitchen-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled-btn" disabled>
              Send to Kitchen
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white">
    <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
      <p class="text-sm text-gray-500 text-center">&copy; {% now 'Y' %} Restaurant Management System</p>
    </div>
  </footer>
</div>

<!-- Variant Selection Modal -->
<div id="modal-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40" aria-hidden="true" role="dialog"></div>
<div id="variant-modal" class="hidden fixed z-50 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg shadow-xl max-w-md w-full" role="dialog" aria-labelledby="variant-item-name" aria-modal="true">
  <div class="p-4 sm:p-6">
    <h3 id="variant-item-name" class="text-lg font-medium text-gray-900 mb-4">Item Variants</h3>
    <div id="variant-attributes-container" class="space-y-4">
      <!-- Variant options will be populated here -->
    </div>
    <div class="mt-5 sm:mt-6 flex justify-end space-x-3">
      <button id="cancel-variant-btn" class="inline-flex justify-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
        Cancel
      </button>
      <button id="add-variant-btn" class="inline-flex justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
        Add to Order
      </button>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="loading-overlay hidden fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50" role="alert" aria-busy="true" aria-label="Loading">
  <div class="bg-white p-6 rounded-lg shadow-lg text-center">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mx-auto"></div>
    <p class="mt-4 text-gray-700">Loading...</p>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
  window.waiterOrderContext = {
    csrfToken: "{{ frappe.session.csrf_token }}"
  };
</script>
<script defer src="/assets/restaurant_management/js/waiter_order.js"></script>
{% endblock %}
